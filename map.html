<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body, #map { width: 100%; height: 100%; }
    .info-window {
      padding: 10px;
      font-family: 'Nanum Gothic', sans-serif;
      font-size: 14px;
      line-height: 1.5;
    }
    .info-window .name {
      font-weight: bold;
      font-size: 16px;
      color: #059669;
      margin-bottom: 5px;
    }
    .info-window .address {
      color: #666;
      font-size: 13px;
    }
    .info-window .holes {
      color: #333;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=8095757cf5f015f7d87d17e53171503f&libraries=services&autoload=false"></script>
  <script>
    // URL 파라미터 파싱
    var params = new URLSearchParams(window.location.search);
    var initLat = parseFloat(params.get('lat')) || 36.5;
    var initLng = parseFloat(params.get('lng')) || 127.5;
    var initLevel = parseInt(params.get('level')) || 13;

    kakao.maps.load(function() {
      var container = document.getElementById('map');
      var options = {
        center: new kakao.maps.LatLng(initLat, initLng),
        level: initLevel
      };
      var map = new kakao.maps.Map(container, options);

      // 줌 컨트롤
      var zoomControl = new kakao.maps.ZoomControl();
      map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

      // Geocoder
      var geocoder = new kakao.maps.services.Geocoder();

      // 마커 이미지
      var markerImage = new kakao.maps.MarkerImage(
        'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png',
        new kakao.maps.Size(35, 45)
      );

      // 인포윈도우
      var infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

      // 마커 생성 함수
      function addMarker(place, position) {
        var marker = new kakao.maps.Marker({
          map: map,
          position: position,
          image: markerImage
        });
        kakao.maps.event.addListener(marker, 'click', function() {
          var content = '<div class="info-window">' +
            '<div class="name">' + place.name + '</div>' +
            '<div class="address">' + place.address + '</div>' +
            '<div class="holes">홀 수: ' + place.holes + '홀</div>' +
            '</div>';
          infowindow.setContent(content);
          infowindow.open(map, marker);
        });
      }

      // 앱에서 데이터 수신
      window.updateMarkers = function(data) {
        data.forEach(function(place) {
          if (place.lat && place.lng) {
            addMarker(place, new kakao.maps.LatLng(place.lat, place.lng));
          } else if (place.address) {
            geocoder.addressSearch(place.address, function(result, status) {
              if (status === kakao.maps.services.Status.OK) {
                addMarker(place, new kakao.maps.LatLng(result[0].y, result[0].x));
              }
            });
          }
        });
      };

      // 지도 이동 함수
      window.moveToLocation = function(lat, lng) {
        map.setCenter(new kakao.maps.LatLng(lat, lng));
      };

      // 줌 설정 함수
      window.setZoom = function(level) {
        map.setLevel(level);
      };

      // 지도 클릭시 인포윈도우 닫기
      kakao.maps.event.addListener(map, 'click', function() {
        infowindow.close();
        window.ReactNativeWebView && window.ReactNativeWebView.postMessage(JSON.stringify({ type: 'mapClick' }));
      });

      // 준비 완료 알림
      window.ReactNativeWebView && window.ReactNativeWebView.postMessage(JSON.stringify({ type: 'mapReady' }));
    });
  </script>
</body>
</html>
